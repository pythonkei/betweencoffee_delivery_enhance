<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¬è©¦å¤šé‡è¨Šæ¯å½ˆå‡ºå•é¡Œ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .log {
            margin-top: 20px;
            padding: 10px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-bottom: 1px solid #eee;
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        .warning { color: orange; }
    </style>
</head>
<body>
    <h1>æ¸¬è©¦å¤šé‡è¨Šæ¯å½ˆå‡ºå•é¡Œ</h1>
    
    <div class="test-section">
        <h2>æ¨¡æ“¬æŒ‰éˆ•é»æ“Šäº‹ä»¶</h2>
        <p>é»æ“Šä»¥ä¸‹æŒ‰éˆ•æ¨¡æ“¬ä¸åŒçš„æ“ä½œï¼Œè§€å¯Ÿæ§åˆ¶å°å’Œé é¢é¡¯ç¤ºçš„è¨Šæ¯æ•¸é‡ï¼š</p>
        
        <button id="test-start-prep">æ¨¡æ“¬ã€Œé–‹å§‹è£½ä½œã€æŒ‰éˆ•</button>
        <button id="test-mark-ready">æ¨¡æ“¬ã€Œå·²å°±ç·’ã€æŒ‰éˆ•</button>
        <button id="test-mark-collected">æ¨¡æ“¬ã€Œå®¢æˆ¶å·²æå–ã€æŒ‰éˆ•</button>
        
        <div class="log" id="event-log">
            <h3>äº‹ä»¶æ—¥èªŒï¼š</h3>
        </div>
    </div>
    
    <div class="test-section">
        <h2>ç•¶å‰çµ„ä»¶ç‹€æ…‹</h2>
        <div id="component-status">
            <p>æ­£åœ¨æª¢æŸ¥çµ„ä»¶ç‹€æ…‹...</p>
        </div>
    </div>
    
    <div class="test-section">
        <h2>è§£æ±ºæ–¹æ¡ˆ</h2>
        <p>å•é¡Œï¼šç•¶é»æ“ŠæŒ‰éˆ•æ™‚ï¼Œå¤šå€‹çµ„ä»¶åŒæ™‚é¡¯ç¤ºæˆåŠŸè¨Šæ¯ï¼Œå°è‡´é‡è¤‡å½ˆå‡ºã€‚</p>
        <p>è§£æ±ºæ–¹æ¡ˆï¼šåªåœ¨ä¸€å€‹åœ°æ–¹é¡¯ç¤ºæˆåŠŸè¨Šæ¯ï¼ˆqueue-manager.jsï¼‰ï¼Œå…¶ä»–çµ„ä»¶åªè™•ç†å…¶ä»–é‚è¼¯ã€‚</p>
        <p>å·²ä¿®æ”¹çš„æ–‡ä»¶ï¼š</p>
        <ul>
            <li>âœ… order-manager.js - ç§»é™¤äº‹ä»¶è™•ç†ä¸­çš„ showToast èª¿ç”¨</li>
            <li>âœ… æ‰€æœ‰æ¸²æŸ“å™¨ - çµ±ä¸€ä½¿ç”¨ toast-manager.js</li>
        </ul>
    </div>

    <script>
        // æ¨¡æ“¬ toast-manager.js
        window.toast = {
            success: function(message) {
                logEvent('toast.success', message, 'success');
                console.log('âœ… toast.success:', message);
            },
            error: function(message) {
                logEvent('toast.error', message, 'error');
                console.log('âŒ toast.error:', message);
            },
            info: function(message) {
                logEvent('toast.info', message, 'info');
                console.log('â„¹ï¸ toast.info:', message);
            },
            warning: function(message) {
                logEvent('toast.warning', message, 'warning');
                console.log('âš ï¸ toast.warning:', message);
            }
        };

        // æ¨¡æ“¬ orderManager
        window.orderManager = {
            showToast: function(message, type) {
                logEvent('orderManager.showToast', `${message} (${type})`, 'info');
                console.log(`ğŸ“¢ orderManager.showToast: ${message} (${type})`);
            }
        };

        // æ¨¡æ“¬ queue-manager.js ä¸­çš„æ–¹æ³•
        function simulateStartPreparation(orderId = 123) {
            logEvent('queue-manager.startPreparation', `é–‹å§‹è£½ä½œè¨‚å–® #${orderId}`, 'info');
            
            // 1. èª¿ç”¨ APIï¼ˆæ¨¡æ“¬ï¼‰
            console.log(`ğŸ”„ èª¿ç”¨ API: /eshop/queue/start/${orderId}/`);
            
            // 2. é¡¯ç¤ºæˆåŠŸè¨Šæ¯
            window.toast.success(`âœ… å·²é–‹å§‹è£½ä½œè¨‚å–® #${orderId}`);
            
            // 3. è§¸ç™¼äº‹ä»¶
            document.dispatchEvent(new CustomEvent('order_started_preparing', {
                detail: { 
                    order_id: orderId,
                    estimated_ready_time: '15:30'
                }
            }));
            
            logEvent('äº‹ä»¶è§¸ç™¼', 'order_started_preparing', 'info');
        }

        function simulateMarkAsReady(orderId = 123) {
            logEvent('queue-manager.markAsReady', `æ¨™è¨˜è¨‚å–® #${orderId} ç‚ºå°±ç·’`, 'info');
            
            // 1. èª¿ç”¨ APIï¼ˆæ¨¡æ“¬ï¼‰
            console.log(`ğŸ”„ èª¿ç”¨ API: /eshop/queue/ready/${orderId}/`);
            
            // 2. é¡¯ç¤ºæˆåŠŸè¨Šæ¯
            window.toast.success(`âœ… è¨‚å–® #${orderId} å·²æ¨™è¨˜ç‚ºå°±ç·’`);
            
            // 3. è§¸ç™¼äº‹ä»¶
            document.dispatchEvent(new CustomEvent('order_marked_ready', {
                detail: { order_id: orderId }
            }));
            
            logEvent('äº‹ä»¶è§¸ç™¼', 'order_marked_ready', 'info');
        }

        function simulateMarkAsCollected(orderId = 123) {
            logEvent('queue-manager.markAsCollected', `æ¨™è¨˜è¨‚å–® #${orderId} ç‚ºå·²æå–`, 'info');
            
            // 1. èª¿ç”¨ APIï¼ˆæ¨¡æ“¬ï¼‰
            console.log(`ğŸ”„ èª¿ç”¨ API: /eshop/queue/collected/${orderId}/`);
            
            // 2. é¡¯ç¤ºæˆåŠŸè¨Šæ¯
            window.toast.success(`âœ… è¨‚å–® #${orderId} å·²æ¨™è¨˜ç‚ºå·²æå–`);
            
            // 3. è§¸ç™¼äº‹ä»¶
            document.dispatchEvent(new CustomEvent('order_collected', {
                detail: { order_id: orderId }
            }));
            
            logEvent('äº‹ä»¶è§¸ç™¼', 'order_collected', 'info');
        }

        // æ¨¡æ“¬ order-manager.js ä¸­çš„äº‹ä»¶è™•ç†ï¼ˆä¿®æ”¹å¾Œç‰ˆæœ¬ï¼‰
        document.addEventListener('order_started_preparing', (event) => {
            const orderId = event.detail.order_id;
            logEvent('order-manager.handleOrderStartedPreparing', `è¨‚å–® #${orderId} é–‹å§‹è£½ä½œ`, 'info');
            console.log(`ğŸ”„ order-manager: è¨‚å–® #${orderId} é–‹å§‹è£½ä½œ`);
            // æ³¨æ„ï¼šä¸å†é¡¯ç¤ºæˆåŠŸè¨Šæ¯ï¼Œå·²åœ¨ queue-manager.js ä¸­é¡¯ç¤º
        });

        document.addEventListener('order_marked_ready', (event) => {
            const orderId = event.detail.order_id;
            logEvent('order-manager.handleOrderMarkedReady', `è¨‚å–® #${orderId} å·²æ¨™è¨˜ç‚ºå°±ç·’`, 'info');
            console.log(`ğŸ”„ order-manager: è¨‚å–® #${orderId} å·²æ¨™è¨˜ç‚ºå°±ç·’`);
            // æ³¨æ„ï¼šä¸å†é¡¯ç¤ºæˆåŠŸè¨Šæ¯ï¼Œå·²åœ¨ queue-manager.js ä¸­é¡¯ç¤º
        });

        document.addEventListener('order_collected', (event) => {
            const orderId = event.detail.order_id;
            logEvent('order-manager.handleOrderCollected', `è¨‚å–® #${orderId} å·²æ¨™è¨˜ç‚ºå·²æå–`, 'info');
            console.log(`ğŸ”„ order-manager: è¨‚å–® #${orderId} å·²æ¨™è¨˜ç‚ºå·²æå–`);
            // æ³¨æ„ï¼šä¸å†é¡¯ç¤ºæˆåŠŸè¨Šæ¯ï¼Œå·²åœ¨ queue-manager.js ä¸­é¡¯ç¤º
        });

        // æ—¥èªŒåŠŸèƒ½
        function logEvent(source, message, type = 'info') {
            const logDiv = document.getElementById('event-log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.innerHTML = `<strong>[${new Date().toLocaleTimeString()}] ${source}:</strong> ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // æ›´æ–°çµ„ä»¶ç‹€æ…‹
        function updateComponentStatus() {
            const statusDiv = document.getElementById('component-status');
            statusDiv.innerHTML = `
                <p><strong>çµ„ä»¶ç‹€æ…‹ï¼š</strong></p>
                <ul>
                    <li>âœ… window.toast: ${window.toast ? 'å·²åŠ è¼‰' : 'æœªåŠ è¼‰'}</li>
                    <li>âœ… window.orderManager: ${window.orderManager ? 'å·²åŠ è¼‰' : 'æœªåŠ è¼‰'}</li>
                    <li>âœ… äº‹ä»¶ç›£è½å™¨: å·²è¨»å†Š</li>
                    <li>âœ… æ¨¡æ“¬å‡½æ•¸: å·²æº–å‚™</li>
                </ul>
                <p><strong>æ¸¬è©¦èªªæ˜ï¼š</strong></p>
                <p>é»æ“ŠæŒ‰éˆ•å¾Œï¼Œè§€å¯Ÿæ§åˆ¶å°è¼¸å‡ºå’Œäº‹ä»¶æ—¥èªŒã€‚ç†æƒ³æƒ…æ³ä¸‹ï¼Œæ¯å€‹æ“ä½œæ‡‰è©²åªé¡¯ç¤ºä¸€å€‹æˆåŠŸè¨Šæ¯ã€‚</p>
            `;
        }

        // ç¶å®šæŒ‰éˆ•äº‹ä»¶
        document.getElementById('test-start-prep').addEventListener('click', () => {
            console.clear();
            document.getElementById('event-log').innerHTML = '<h3>äº‹ä»¶æ—¥èªŒï¼š</h3>';
            logEvent('æ¸¬è©¦é–‹å§‹', 'æ¨¡æ“¬ã€Œé–‹å§‹è£½ä½œã€æŒ‰éˆ•é»æ“Š', 'info');
            simulateStartPreparation();
        });

        document.getElementById('test-mark-ready').addEventListener('click', () => {
            console.clear();
            document.getElementById('event-log').innerHTML = '<h3>äº‹ä»¶æ—¥èªŒï¼š</h3>';
            logEvent('æ¸¬è©¦é–‹å§‹', 'æ¨¡æ“¬ã€Œå·²å°±ç·’ã€æŒ‰éˆ•é»æ“Š', 'info');
            simulateMarkAsReady();
        });

        document.getElementById('test-mark-collected').addEventListener('click', () => {
            console.clear();
            document.getElementById('event-log').innerHTML = '<h3>äº‹ä»¶æ—¥èªŒï¼š</h3>';
            logEvent('æ¸¬è©¦é–‹å§‹', 'æ¨¡æ“¬ã€Œå®¢æˆ¶å·²æå–ã€æŒ‰éˆ•é»æ“Š', 'info');
            simulateMarkAsCollected();
        });

        // åˆå§‹åŒ–
        updateComponentStatus();
        logEvent('ç³»çµ±', 'æ¸¬è©¦é é¢å·²åŠ è¼‰ï¼Œæº–å‚™æ¸¬è©¦å¤šé‡è¨Šæ¯å½ˆå‡ºå•é¡Œ', 'info');
    </script>
</body>
</html>